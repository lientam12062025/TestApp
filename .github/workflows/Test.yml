name: Test WEB

on:
  workflow_dispatch:
    inputs:
      ROM_URL:
        description: 'OTA URL for ROM'
        required: true
        type: string

jobs:
  Build:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ”„ Checkout Website Repo
        uses: actions/checkout@v4
        with:
          # âš ï¸ Sá»¬A TÃŠN KHO WEBSITE Cá»¦A Báº N á»ž ÄÃ‚Y
          repository: thangnguyen2303/hypertn-site
          # âš ï¸ Token quyá»n ghi (Táº¡o trong Developer Settings > Personal access tokens)
          token: ${{ secrets.TNWEB }} 
          path: website-repo
            
      - name: Set up environment
        run: |
          sudo timedatectl set-timezone Asia/Ho_Chi_Minh
          curl -s https://rclone.org/install.sh | sudo bash
          mkdir -p ~/.config/rclone
          echo "${{ secrets.RCLONE }}" | base64 -d > ~/.config/rclone/rclone.conf



      - name: ðŸ“ Update roms.json & Push
        run: |
          echo "Dang quet file tu Drive..."
          rclone listremotes
          # 1. QuÃ©t danh sÃ¡ch file tá»« Drive vÃ  ghi Ä‘Ã¨ vÃ o file roms.json cá»§a web
          # (Rclone Ä‘Ã£ Ä‘Æ°á»£c cÃ i vÃ  config á»Ÿ bÆ°á»›c 'Set up environment' nÃªn dÃ¹ng Ä‘Æ°á»£c luÃ´n)
          rclone lsjson "gdrive3:/TN/ROM" -R --files-only --no-mimetype --no-modtime --include "*.7z" > website-repo/src/data/roms1.json
          #rclone lsjson "gdrive03:/TN/ROM" -R --files-only --no-mimetype --no-modtime --include "*.7z" > website-repo/src/data/roms2.json

          # 2. Commit vÃ  Ä‘áº©y code lÃªn Github
          cd website-repo
          git config --global user.name "Thang Nguyen"
          git config --global user.email "nvthang2303@outlook.com.vn"

          # Kiá»ƒm tra xem cÃ³ gÃ¬ thay Ä‘á»•i khÃ´ng
          if [[ -n $(git status -s) ]]; then
            git add src/data/*.json
            git commit -m "ðŸ¤– Auto-update ROM List: $(date '+%Y-%m-%d %H:%M')"
            git push
            echo "âœ… Da cap nhat Website thanh cong!"
          else
            echo "ðŸ’¤ Khong co file ROM moi, bo qua update web."
          fi

      
